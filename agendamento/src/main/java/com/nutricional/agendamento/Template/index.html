<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>API Funcionário e Horário</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 30px auto; }
        input, button { padding: 8px; margin: 5px 0; width: 100%; }
        .hidden { display: none; }
        ul { padding-left: 0; }
        li { list-style: none; padding: 10px; background: #eee; margin-bottom: 5px; }
    </style>
</head>
<body>

<h2>Login Funcionário</h2>
<div id="login-section">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="senha" placeholder="Senha" required />
    <button onclick="login()">Entrar</button>
</div>

<div id="app-section" class="hidden">
    <h2>Horários Disponíveis</h2>

    <form id="form-horario" onsubmit="criarOuEditarHorario(event)">
        <input type="date" id="data" required />
        <input type="time" id="horaInicio" required />
        <input type="time" id="horaFim" required />
        <button type="submit">Salvar Horário</button>
        <button type="button" onclick="cancelarEdicao()" class="hidden" id="cancel-btn">Cancelar Edição</button>
    </form>

    <ul id="lista-horarios"></ul>

    <button onclick="logout()">Sair</button>
</div>

<script>
    let editandoHorarioId = null;

    async function login() {
        const email = document.getElementById("email").value.trim();
        const senha = document.getElementById("senha").value.trim();

        if (!email || !senha) {
            alert("Preencha email e senha");
            return;
        }

        const res = await fetch("http://localhost:8080/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, senha })
        });

        if (res.ok) {
            alert("Login efetuado com sucesso!");
            document.getElementById("login-section").classList.add("hidden");
            document.getElementById("app-section").classList.remove("hidden");
            carregarHorarios();
        } else {
            alert("Email ou senha inválidos");
        }
    }

    async function carregarHorarios() {
        const res = await fetch("http://localhost:8080/horarios");
        if (res.ok) {
            const horarios = await res.json();
            mostrarHorarios(horarios);
        } else {
            alert("Erro ao carregar horários");
        }
    }

    function mostrarHorarios(horarios) {
        const lista = document.getElementById("lista-horarios");
        lista.innerHTML = "";

        if (horarios.length === 0) {
            lista.innerHTML = "<li>Nenhum horário cadastrado.</li>";
            return;
        }

        horarios.forEach(h => {
            const li = document.createElement("li");
            li.innerHTML = `
        <b>Data:</b> ${h.data} |
        <b>Início:</b> ${h.horaInicio} |
        <b>Fim:</b> ${h.horaFim}
        <br/>
        <button onclick="editarHorario(${h.id})">Editar</button>
        <button onclick="removerHorario(${h.id})">Remover</button>
      `;
            lista.appendChild(li);
        });
    }

    async function criarOuEditarHorario(event) {
        event.preventDefault();

        const data = document.getElementById("data").value;
        const horaInicio = document.getElementById("horaInicio").value;
        const horaFim = document.getElementById("horaFim").value;

        if (!data || !horaInicio || !horaFim) {
            alert("Preencha todos os campos");
            return;
        }

        const horario = { data, horaInicio, horaFim };

        let url = "http://localhost:8080/horarios";
        let method = "POST";

        if (editandoHorarioId) {
            url += `/${editandoHorarioId}`;
            method = "PUT";
        }

        const res = await fetch(url, {
            method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(horario)
        });

        if (res.ok) {
            alert(editandoHorarioId ? "Horário editado!" : "Horário criado!");
            cancelarEdicao();
            carregarHorarios();
        } else {
            const error = await res.text();
            alert("Erro: " + error);
        }
    }

    async function editarHorario(id) {
        const res = await fetch(`http://localhost:8080/horarios`);
        if (res.ok) {
            const horarios = await res.json();
            const h = horarios.find(h => h.id === id);
            if (!h) {
                alert("Horário não encontrado");
                return;
            }
            document.getElementById("data").value = h.data;
            document.getElementById("horaInicio").value = h.horaInicio;
            document.getElementById("horaFim").value = h.horaFim;

            editandoHorarioId = id;
            document.getElementById("cancel-btn").classList.remove("hidden");
        }
    }

    async function removerHorario(id) {
        if (!confirm("Confirma remoção do horário?")) return;

        const res = await fetch(`http://localhost:8080/horarios/${id}`, {
            method: "DELETE"
        });

        if (res.ok) {
            alert("Horário removido");
            carregarHorarios();
        } else {
            alert("Erro ao remover horário");
        }
    }

    function cancelarEdicao() {
        editandoHorarioId = null;
        document.getElementById("form-horario").reset();
        document.getElementById("cancel-btn").classList.add("hidden");
    }

    function logout() {
        // Simples: só volta para tela de login
        document.getElementById("login-section").classList.remove("hidden");
        document.getElementById("app-section").classList.add("hidden");
        cancelarEdicao();
    }
</script>

</body>
</html>
